<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íˆì–´ë¡œ íƒ€ì›Œ ë””íœìŠ¤ - ì „ì„¤ì˜ ìˆ˜í˜¸ì</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .game-container {
            text-align: center;
        }
        
        #gameCanvas {
            border: 3px solid #333;
            border-radius: 10px;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        
        .game-info {
            margin-top: 10px;
            color: white;
            font-size: 18px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .controls {
            margin-top: 10px;
            color: white;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 style="color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">ğŸ° íˆì–´ë¡œ íƒ€ì›Œ ë””íœìŠ¤ - ì „ì„¤ì˜ ìˆ˜í˜¸ì</h1>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div class="game-info">
            <div id="score">ì ìˆ˜: 0</div>
            <div id="coins">ì½”ì¸: 0</div>
            <div id="title">ì¹­í˜¸: ğŸŒ± ìƒˆì‹¹ ì „ì‚¬</div>
        </div>
        <div class="controls">
            <p>ğŸ® ì¡°ì‘ë²•: Z(ì´ì•Œ) | ìŠ¤í˜ì´ìŠ¤(ì í”„) | D(ë°©ì–´) | Q(ìƒì ) | R(ë½‘ê¸°)</p>
        </div>
    </div>

    <script>
        // ê²Œì„ ìº”ë²„ìŠ¤ ì„¤ì •
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            score: 0,
            coins: 0,
            title: "ğŸŒ± ìƒˆì‹¹ ì „ì‚¬",
            gameTime: 0,
            isPaused: false,
            isShopOpen: false,
            isGachaOpen: false,
            enemiesKilled: 0,
            crowsKilled: 0,
            gachaResult: null,
            isDivineBlessing: false,
            divineBlessingTimer: 0,
            isGameOver: false,
            gameOverTimer: 0,
            gameDuration: 30, // 30ì´ˆ ê²Œì„
            bossSpawnTime: 24, // 24ì´ˆì— ë³´ìŠ¤ ì¶œí˜„
            bossSpawned: false,
            isSniperActive: false,
            sniperTimer: 0,
            sniperBullets: [],
            isFlamethrowerActive: false,
            flamethrowerTimer: 0,
            flamethrowerBullets: []
        };
        
        // ê²Œì„ ê°ì²´ë“¤
        const enemies = [];
        const crows = [];
        const bullets = [];
        const bosses = [];
        
        // íƒ€ì´ë¨¸ë“¤
        let enemySpawnTimer = 0;
        let crowSpawnTimer = 0;
        
        // í”Œë ˆì´ì–´
        const player = {
            x: 100,
            y: 450,
            width: 40,
            height: 60,
            velocityY: 0,
            isJumping: false,
            isDefending: false,
            health: 100,
            maxHealth: 100
        };
        
        // ê²Œì„ ë£¨í”„
        function gameLoop() {
            if (!gameState.isPaused && !gameState.isShopOpen && !gameState.isGachaOpen) {
                updateGame();
            }
            drawGame();
            requestAnimationFrame(gameLoop);
        }
        
        // ê²Œì„ ì—…ë°ì´íŠ¸
        function updateGame() {
            gameState.gameTime += 1/60;
            updatePlayer();
            updateEnemies();
            updateCrows();
            updateBosses();
            updateBullets();
            spawnEnemies();
            spawnCrows();
            spawnBoss();
            checkCollisions();
            checkGameOver();
            checkGameWin();
        }
        
        // í”Œë ˆì´ì–´ ì—…ë°ì´íŠ¸
        function updatePlayer() {
            // ì¤‘ë ¥
            player.velocityY += 0.8;
            player.y += player.velocityY;
            
            // ë°”ë‹¥ ì²´í¬
            if (player.y > 430) {
                player.y = 430;
                player.velocityY = 0;
                player.isJumping = false;
            }
            
            // ì²´ë ¥ íšŒë³µ
            if (player.health < player.maxHealth && gameState.gameTime % 60 === 0) {
                player.health = Math.min(player.health + 1, player.maxHealth);
            }
            
            // ì‹ ì˜ ì¶•ë³µ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
            if (gameState.isDivineBlessing) {
                gameState.divineBlessingTimer += 1/60;
                if (gameState.divineBlessingTimer >= 5) { // 5ì´ˆ í›„ ë¬´ì  í•´ì œ
                    gameState.isDivineBlessing = false;
                    gameState.divineBlessingTimer = 0;
                    console.log('ì‹ ì˜ ì¶•ë³µ ë¬´ì  ì‹œê°„ ì¢…ë£Œ!');
                }
            }
            
            // ìŠ¤ë‚˜ì´í¼ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
            if (gameState.isSniperActive) {
                gameState.sniperTimer += 1/60;
                if (gameState.sniperTimer >= 5) { // 5ì´ˆ í›„ ìŠ¤ë‚˜ì´í¼ í•´ì œ
                                gameState.isSniperActive = false;
            gameState.sniperTimer = 0;
            gameState.sniperBullets = [];
            gameState.isFlamethrowerActive = false;
            gameState.flamethrowerTimer = 0;
            gameState.flamethrowerBullets = [];
                    console.log('ìŠ¤ë‚˜ì´í¼ ì €ê²© ì‹œê°„ ì¢…ë£Œ!');
                }
            }
            
            // í™”ì—¼ë°©ì‚¬ê¸° íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
            if (gameState.isFlamethrowerActive) {
                gameState.flamethrowerTimer += 1/60;
                if (gameState.flamethrowerTimer >= 8) { // 8ì´ˆ í›„ í™”ì—¼ë°©ì‚¬ê¸° í•´ì œ
                    gameState.isFlamethrowerActive = false;
                    gameState.flamethrowerTimer = 0;
                    gameState.flamethrowerBullets = [];
                    console.log('í™”ì—¼ë°©ì‚¬ê¸° ì‹œê°„ ì¢…ë£Œ!');
                }
            }
        }
        
        // ì  ìƒì„±
        function spawnEnemies() {
            enemySpawnTimer += 1/60;
            
            // ë” ì‰½ê²Œ ì  ìƒì„± (1ì´ˆë§ˆë‹¤, ìµœëŒ€ 3ë§ˆë¦¬)
            if (enemySpawnTimer > 1 && enemies.length < 3) {
                enemies.push({
                    x: canvas.width,
                    y: 450,
                    width: 40,
                    height: 60,
                    speed: -0.8, // ë” ëŠë¦¬ê²Œ
                    health: 15 // ì²´ë ¥ ì¤„ì„
                });
                enemySpawnTimer = 0;
                console.log('ì  ìƒì„±! í˜„ì¬ ì  ìˆ˜:', enemies.length, 'ìœ„ì¹˜:', canvas.width, 450);
            }
        }
        
        // ë³´ìŠ¤ ìƒì„±
        function spawnBoss() {
            if (gameState.gameTime >= gameState.bossSpawnTime && !gameState.bossSpawned && bosses.length === 0) {
                bosses.push({
                    x: canvas.width,
                    y: 400,
                    width: 80,
                    height: 100,
                    speed: -0.5,
                    health: 200,
                    maxHealth: 200,
                    isBoss: true
                });
                gameState.bossSpawned = true;
                console.log('ğŸ‘¹ ë³´ìŠ¤ ì¶œí˜„! ì²´ë ¥:', 200);
            }
        }
        
        // ê¹Œë§ˆê·€ ìƒì„±
        function spawnCrows() {
            crowSpawnTimer += 1/60;
            
            // ë” ì‰½ê²Œ ê¹Œë§ˆê·€ ìƒì„± (2ì´ˆë§ˆë‹¤, ìµœëŒ€ 2ë§ˆë¦¬)
            if (crowSpawnTimer > 2 && crows.length < 2) {
                crows.push({
                    x: canvas.width,
                    y: Math.random() * 200 + 100,
                    width: 30,
                    height: 30,
                    speed: -1.2, // ë” ëŠë¦¬ê²Œ
                    health: 12 // ì²´ë ¥ ì¤„ì„
                });
                crowSpawnTimer = 0;
                console.log('ê¹Œë§ˆê·€ ìƒì„±! í˜„ì¬ ê¹Œë§ˆê·€ ìˆ˜:', crows.length, 'ìœ„ì¹˜:', canvas.width, Math.random() * 200 + 100);
            }
        }
        
        // ì  ì—…ë°ì´íŠ¸
        function updateEnemies() {
            for (let i = enemies.length - 1; i >= 0; i--) {
                const enemy = enemies[i];
                
                // ì ì´ í”Œë ˆì´ì–´ë¥¼ í–¥í•´ ë‹¬ë ¤ì˜´
                if (enemy.x > player.x + 50) {
                    // í”Œë ˆì´ì–´ê°€ ë©€ë¦¬ ìˆìœ¼ë©´ ë¹ ë¥´ê²Œ ë‹¬ë ¤ì˜´
                    enemy.x -= 2;
                } else {
                    // ê°€ê¹Œì´ ìˆìœ¼ë©´ ì²œì²œíˆ ì ‘ê·¼
                    enemy.x -= 1;
                }
                
                // í”Œë ˆì´ì–´ì™€ ì¶©ëŒ
                if (enemy.x < player.x + 30 && 
                    enemy.x + 40 > player.x &&
                    enemy.y < player.y + 60 &&
                    enemy.y + 60 > player.y) {
                    
                    if (!player.isDefending && !gameState.isDivineBlessing) {
                        player.health -= 10;
                        console.log('í”Œë ˆì´ì–´ê°€ ì ì—ê²Œ ë§ì•˜ìŠµë‹ˆë‹¤! ì²´ë ¥:', player.health);
                    } else if (gameState.isDivineBlessing) {
                        console.log('ì‹ ì˜ ì¶•ë³µìœ¼ë¡œ ì  ê³µê²©ì„ ë§‰ì•˜ìŠµë‹ˆë‹¤!');
                    } else {
                        console.log('ë°©ì–´ë§‰ìœ¼ë¡œ ì  ê³µê²©ì„ ë§‰ì•˜ìŠµë‹ˆë‹¤!');
                    }
                    
                    enemies.splice(i, 1);
                    continue;
                }
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±°
                if (enemy.x < -50) {
                    enemies.splice(i, 1);
                }
            }
        }
        
        // ê¹Œë§ˆê·€ ì—…ë°ì´íŠ¸
        function updateCrows() {
            for (let i = crows.length - 1; i >= 0; i--) {
                const crow = crows[i];
                
                // ê¹Œë§ˆê·€ê°€ í”Œë ˆì´ì–´ë¥¼ í–¥í•´ ë‚ ì•„ì˜´
                if (crow.x > player.x + 50) {
                    // í”Œë ˆì´ì–´ê°€ ë©€ë¦¬ ìˆìœ¼ë©´ ë¹ ë¥´ê²Œ ë‚ ì•„ì˜´
                    crow.x -= 2.5;
                } else {
                    // ê°€ê¹Œì´ ìˆìœ¼ë©´ ì²œì²œíˆ ì ‘ê·¼
                    crow.x -= 1.5;
                }
                
                // í”Œë ˆì´ì–´ë¥¼ í–¥í•´ ìœ„ì•„ë˜ë¡œ ì›€ì§ì„
                if (crow.y > player.y + 10) {
                    crow.y -= 1;
                } else if (crow.y < player.y - 10) {
                    crow.y += 1;
                }
                
                // í”Œë ˆì´ì–´ì™€ ì¶©ëŒ (ë°©ì–´ë§‰ ëš«ê¸°, ì‹ ì˜ ì¶•ë³µì€ ëš«ì§€ ëª»í•¨)
                if (crow.x < player.x + 30 && 
                    crow.x + 30 > player.x &&
                    crow.y < player.y + 60 &&
                    crow.y + 30 > player.y) {
                    
                    if (!gameState.isDivineBlessing) {
                        player.health -= 15;
                        console.log('í”Œë ˆì´ì–´ê°€ ê¹Œë§ˆê·€ì—ê²Œ ë§ì•˜ìŠµë‹ˆë‹¤! (ë°©ì–´ë§‰ ëš«ê¸°) ì²´ë ¥:', player.health);
                    } else {
                        console.log('ì‹ ì˜ ì¶•ë³µìœ¼ë¡œ ê¹Œë§ˆê·€ ê³µê²©ì„ ë§‰ì•˜ìŠµë‹ˆë‹¤!');
                    }
                    
                    crows.splice(i, 1);
                    continue;
                }
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±°
                if (crow.x < -50) {
                    crows.splice(i, 1);
                }
            }
        }
        
        // ë³´ìŠ¤ ì—…ë°ì´íŠ¸
        function updateBosses() {
            for (let i = bosses.length - 1; i >= 0; i--) {
                const boss = bosses[i];
                
                // ë³´ìŠ¤ê°€ í”Œë ˆì´ì–´ë¥¼ í–¥í•´ ì´ë™
                if (boss.x > player.x + 100) {
                    boss.x -= boss.speed;
                } else {
                    boss.x -= boss.speed * 0.5; // ê°€ê¹Œì´ ìˆìœ¼ë©´ ì²œì²œíˆ
                }
                
                // ë³´ìŠ¤ì™€ í”Œë ˆì´ì–´ ì¶©ëŒ
                if (boss.x < player.x + 30 && 
                    boss.x + 80 > player.x &&
                    boss.y < player.y + 60 &&
                    boss.y + 100 > player.y) {
                    
                    if (!player.isDefending && !gameState.isDivineBlessing) {
                        player.health -= 30; // ë³´ìŠ¤ëŠ” ë” ê°•í•œ ë°ë¯¸ì§€
                        console.log('í”Œë ˆì´ì–´ê°€ ë³´ìŠ¤ì—ê²Œ ë§ì•˜ìŠµë‹ˆë‹¤! ì²´ë ¥:', player.health);
                    } else if (gameState.isDivineBlessing) {
                        console.log('ì‹ ì˜ ì¶•ë³µìœ¼ë¡œ ë³´ìŠ¤ ê³µê²©ì„ ë§‰ì•˜ìŠµë‹ˆë‹¤!');
                    } else {
                        console.log('ë°©ì–´ë§‰ìœ¼ë¡œ ë³´ìŠ¤ ê³µê²©ì„ ë§‰ì•˜ìŠµë‹ˆë‹¤!');
                    }
                    
                    // ë³´ìŠ¤ëŠ” ì œê±°ë˜ì§€ ì•ŠìŒ (ì²´ë ¥ì´ ë‚¨ì•„ìˆìœ¼ë©´)
                }
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±°
                if (boss.x < -100) {
                    bosses.splice(i, 1);
                }
            }
        }
        
        // ì´ì•Œ ì—…ë°ì´íŠ¸
        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                bullet.x += bullet.speed;
                
                if (bullet.x > canvas.width) {
                    bullets.splice(i, 1);
                }
            }
            
            // ìŠ¤ë‚˜ì´í¼ ì´ì•Œ ì—…ë°ì´íŠ¸
            for (let i = gameState.sniperBullets.length - 1; i >= 0; i--) {
                const sniperBullet = gameState.sniperBullets[i];
                sniperBullet.x += sniperBullet.speedX;
                sniperBullet.y += sniperBullet.speedY;
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±°
                if (sniperBullet.x > canvas.width || sniperBullet.y < 0) {
                    gameState.sniperBullets.splice(i, 1);
                }
            }
            
            // í™”ì—¼ë°©ì‚¬ê¸° ì´ì•Œ ì—…ë°ì´íŠ¸
            for (let i = gameState.flamethrowerBullets.length - 1; i >= 0; i--) {
                const flamethrowerBullet = gameState.flamethrowerBullets[i];
                flamethrowerBullet.x += flamethrowerBullet.speedX;
                flamethrowerBullet.y += flamethrowerBullet.speedY;
                
                // ìˆ˜ëª… ê°ì†Œ
                if (flamethrowerBullet.life) {
                    flamethrowerBullet.life--;
                    if (flamethrowerBullet.life <= 0) {
                        gameState.flamethrowerBullets.splice(i, 1);
                        continue;
                    }
                }
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±°
                if (flamethrowerBullet.x > canvas.width || flamethrowerBullet.y < 0 || flamethrowerBullet.y > canvas.height) {
                    gameState.flamethrowerBullets.splice(i, 1);
                }
            }
        }
        
        // ì¶©ëŒ ì²´í¬
        function checkCollisions() {
            for (let bIndex = bullets.length - 1; bIndex >= 0; bIndex--) {
                const bullet = bullets[bIndex];
                let bulletHit = false;
                
                // ì ê³¼ ì´ì•Œ ì¶©ëŒ
                for (let eIndex = enemies.length - 1; eIndex >= 0; eIndex--) {
                    const enemy = enemies[eIndex];
                    if (bullet.x < enemy.x + 40 &&
                        bullet.x + 15 > enemy.x &&
                        bullet.y < enemy.y + 60 &&
                        bullet.y + 8 > enemy.y) {
                        
                        enemy.health -= 15;
                        bullets.splice(bIndex, 1);
                        bulletHit = true;
                        
                        if (enemy.health <= 0) {
                            enemies.splice(eIndex, 1);
                            gameState.score += 100;
                            gameState.coins += 30;
                            gameState.enemiesKilled++;
                            updateTitle();
                            console.log('ì  ì²˜ì¹˜! ì ìˆ˜:', gameState.score, 'ì½”ì¸:', gameState.coins);
                        }
                        break;
                    }
                }
                
                if (bulletHit) continue;
                
                // ê¹Œë§ˆê·€ì™€ ì´ì•Œ ì¶©ëŒ
                for (let cIndex = crows.length - 1; cIndex >= 0; cIndex--) {
                    const crow = crows[cIndex];
                    if (bullet.x < crow.x + 30 &&
                        bullet.x + 15 > crow.x &&
                        bullet.y < crow.y + 30 &&
                        bullet.y + 8 > crow.y) {
                        
                        crow.health -= 15;
                        bullets.splice(bIndex, 1);
                        
                        if (crow.health <= 0) {
                            crows.splice(cIndex, 1);
                            gameState.score += 150;
                            gameState.coins += 50;
                            gameState.crowsKilled++;
                            updateTitle();
                            console.log('ê¹Œë§ˆê·€ ì²˜ì¹˜! ì ìˆ˜:', gameState.score, 'ì½”ì¸:', gameState.coins);
                        }
                        break;
                    }
                }
                
                // ë³´ìŠ¤ì™€ ì´ì•Œ ì¶©ëŒ
                for (let bossIndex = bosses.length - 1; bossIndex >= 0; bossIndex--) {
                    const boss = bosses[bossIndex];
                    if (bullet.x < boss.x + 80 &&
                        bullet.x + 15 > boss.x &&
                        bullet.y < boss.y + 100 &&
                        bullet.y + 8 > boss.y) {
                        
                        boss.health -= 20; // ë³´ìŠ¤ëŠ” ë” ë§ì€ ë°ë¯¸ì§€ í•„ìš”
                        bullets.splice(bIndex, 1);
                        
                        if (boss.health <= 0) {
                            bosses.splice(bossIndex, 1);
                            gameState.score += 500; // ë³´ìŠ¤ ì²˜ì¹˜ ì‹œ í° ì ìˆ˜
                            gameState.coins += 200; // ë³´ìŠ¤ ì²˜ì¹˜ ì‹œ ë§ì€ ì½”ì¸
                            console.log('ğŸ‘¹ ë³´ìŠ¤ ì²˜ì¹˜! ì ìˆ˜:', gameState.score, 'ì½”ì¸:', gameState.coins);
                        }
                        break;
                    }
                }
            }
            
            // ìŠ¤ë‚˜ì´í¼ ì´ì•Œ ì¶©ëŒ ì²´í¬
            for (let sIndex = gameState.sniperBullets.length - 1; sIndex >= 0; sIndex--) {
                const sniperBullet = gameState.sniperBullets[sIndex];
                let sniperHit = false;
                
                // ì ê³¼ ìŠ¤ë‚˜ì´í¼ ì´ì•Œ ì¶©ëŒ
                for (let eIndex = enemies.length - 1; eIndex >= 0; eIndex--) {
                    const enemy = enemies[eIndex];
                    if (sniperBullet.x < enemy.x + 40 &&
                        sniperBullet.x + 8 > enemy.x &&
                        sniperBullet.y < enemy.y + 60 &&
                        sniperBullet.y + 8 > enemy.y) {
                        
                        enemies.splice(eIndex, 1);
                        gameState.sniperBullets.splice(sIndex, 1);
                        gameState.score += 100;
                        gameState.coins += 30;
                        gameState.enemiesKilled++;
                        updateTitle();
                        sniperHit = true;
                        console.log('ìŠ¤ë‚˜ì´í¼ë¡œ ì  ì²˜ì¹˜!');
                        break;
                    }
                }
                
                if (sniperHit) continue;
                
                // ê¹Œë§ˆê·€ì™€ ìŠ¤ë‚˜ì´í¼ ì´ì•Œ ì¶©ëŒ
                for (let cIndex = crows.length - 1; cIndex >= 0; cIndex--) {
                    const crow = crows[cIndex];
                    if (sniperBullet.x < crow.x + 30 &&
                        sniperBullet.x + 8 > crow.x &&
                        sniperBullet.y < crow.y + 30 &&
                        sniperBullet.y + 8 > crow.y) {
                        
                        crows.splice(cIndex, 1);
                        gameState.sniperBullets.splice(sIndex, 1);
                        gameState.score += 150;
                        gameState.coins += 50;
                        gameState.crowsKilled++;
                        updateTitle();
                        console.log('ìŠ¤ë‚˜ì´í¼ë¡œ ê¹Œë§ˆê·€ ì²˜ì¹˜!');
                        break;
                    }
                }
                
                // ë³´ìŠ¤ì™€ ìŠ¤ë‚˜ì´í¼ ì´ì•Œ ì¶©ëŒ
                for (let bossIndex = bosses.length - 1; bossIndex >= 0; bossIndex--) {
                    const boss = bosses[bossIndex];
                    if (sniperBullet.x < boss.x + 80 &&
                        sniperBullet.x + 8 > boss.x &&
                        sniperBullet.y < boss.y + 100 &&
                        sniperBullet.y + 8 > boss.y) {
                        
                        boss.health -= 50; // ìŠ¤ë‚˜ì´í¼ëŠ” ë³´ìŠ¤ì—ê²Œë„ ê°•ë ¥
                        gameState.sniperBullets.splice(sIndex, 1);
                        
                        if (boss.health <= 0) {
                            bosses.splice(bossIndex, 1);
                            gameState.score += 500;
                            gameState.coins += 200;
                            console.log('ìŠ¤ë‚˜ì´í¼ë¡œ ë³´ìŠ¤ ì²˜ì¹˜!');
                        }
                        break;
                    }
                }
            }
            
            // í™”ì—¼ë°©ì‚¬ê¸° ë²”ìœ„ ê³µê²© ì‹œê°ì  íš¨ê³¼
            if (gameState.isFlamethrowerActive) {
                // í”Œë ˆì´ì–´ ì£¼ë³€ì— í™”ì—¼ ì›í˜• íš¨ê³¼ ê·¸ë¦¬ê¸°
                const playerCenterX = player.x + 20;
                const playerCenterY = player.y + 30;
                const range = 200;
                
                // í™”ì—¼ ì›í˜• íš¨ê³¼
                const flameGradient = ctx.createRadialGradient(playerCenterX, playerCenterY, 0, playerCenterX, playerCenterY, range);
                flameGradient.addColorStop(0, 'rgba(255, 69, 0, 0.8)');
                flameGradient.addColorStop(0.3, 'rgba(255, 140, 0, 0.6)');
                flameGradient.addColorStop(0.7, 'rgba(255, 215, 0, 0.4)');
                flameGradient.addColorStop(1, 'rgba(255, 69, 0, 0.1)');
                
                ctx.fillStyle = flameGradient;
                ctx.beginPath();
                ctx.arc(playerCenterX, playerCenterY, range, 0, Math.PI * 2);
                ctx.fill();
                
                // í™”ì—¼ í…Œë‘ë¦¬ íš¨ê³¼
                ctx.strokeStyle = '#FF4500';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(playerCenterX, playerCenterY, range, 0, Math.PI * 2);
                ctx.stroke();
            }
        }
        
        // ì¹­í˜¸ ì—…ë°ì´íŠ¸
        function updateTitle() {
            if (gameState.enemiesKilled >= 2000) {
                gameState.title = "ğŸŒŸ ì‹ í™”ê¸‰ ì „ì‚¬";
            } else if (gameState.enemiesKilled >= 1000) {
                gameState.title = "ğŸ‘‘ ì „ì„¤ì˜ ìš©ì‚¬";
            } else if (gameState.enemiesKilled >= 500) {
                gameState.title = "âš”ï¸ ì™•ì¢Œì˜ ì§€ë°°ì";
            } else if (gameState.enemiesKilled >= 200) {
                gameState.title = "ğŸ›¡ï¸ ì „ì¥ì˜ ì˜ì›…";
            } else if (gameState.enemiesKilled >= 100) {
                gameState.title = "âš”ï¸ ì² ë²½ ìˆ˜í˜¸ì";
            } else if (gameState.enemiesKilled >= 50) {
                gameState.title = "ğŸ—¡ï¸ ê²€ì˜ ë‹¬ì¸";
            } else if (gameState.enemiesKilled >= 10) {
                gameState.title = "ğŸ”¥ ë¶ˆê½ƒ ê²¬ìŠµìƒ";
            } else {
                gameState.title = "ğŸŒ± ìƒˆì‹¹ ì „ì‚¬";
            }
        }
        
        // ê²Œì„ ì˜¤ë²„ ì²´í¬
        function checkGameOver() {
            if (player.health <= 0 && !gameState.isGameOver) {
                gameState.isGameOver = true;
                gameState.isPaused = true;
                gameState.gameOverTimer = 0;
                console.log('ê²Œì„ ì˜¤ë²„!');
            }
        }
        
        // ê²Œì„ ìŠ¹ë¦¬ ì²´í¬
        function checkGameWin() {
            if (gameState.gameTime >= gameState.gameDuration && !gameState.isGameOver) {
                gameState.isGameOver = true;
                gameState.isPaused = true;
                gameState.gameOverTimer = 0;
                console.log('ê²Œì„ ìŠ¹ë¦¬! 30ì´ˆ ìƒì¡´!');
            }
        }
        
        // ê²Œì„ ê·¸ë¦¬ê¸°
        function drawGame() {
            // ë°°ê²½ ì§€ìš°ê¸°
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // í•˜ëŠ˜ ê·¸ë¼ë°ì´ì…˜
            const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            skyGradient.addColorStop(0, '#1E90FF');
            skyGradient.addColorStop(0.3, '#87CEEB');
            skyGradient.addColorStop(0.7, '#98FB98');
            skyGradient.addColorStop(1, '#90EE90');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ë°”ë‹¥ ê·¸ë¦¬ê¸°
            drawGround();
            
            // ì ë“¤ ê·¸ë¦¬ê¸°
            drawEnemies();
            drawCrows();
            drawBosses();
            drawBullets();
            drawSniperBullets();
            drawFlamethrowerBullets();
            
            // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸°
            drawPlayer();
            
            // UI ê·¸ë¦¬ê¸°
            drawUI();
            
            // ìƒì ì´ë‚˜ ë½‘ê¸°ê°€ ì—´ë ¤ìˆìœ¼ë©´ ì˜¤ë²„ë ˆì´
            if (gameState.isShopOpen) {
                drawShopOverlay();
            } else if (gameState.isGachaOpen) {
                drawGachaOverlay();
            }
            
            // ê²Œì„ì˜¤ë²„ íš¨ê³¼
            if (gameState.isGameOver) {
                drawGameOverOverlay();
            }
        }
        
        // ë°”ë‹¥ ê·¸ë¦¬ê¸°
        function drawGround() {
            const groundGradient = ctx.createLinearGradient(0, 500, 0, canvas.height);
            groundGradient.addColorStop(0, '#8B4513');
            groundGradient.addColorStop(0.5, '#A0522D');
            groundGradient.addColorStop(1, '#654321');
            ctx.fillStyle = groundGradient;
            ctx.fillRect(0, 500, canvas.width, 100);
            
            // ì”ë””
            ctx.fillStyle = '#228B22';
            ctx.fillRect(0, 500, canvas.width, 5);
        }
        
        // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸° (ê³ ì–‘ì´ ìºë¦­í„°)
        function drawPlayer() {
            // ê³ ì–‘ì´ ëª¸ì²´ (ì—°í•œ ê°ˆìƒ‰)
            const bodyGradient = ctx.createRadialGradient(player.x + 20, player.y + 30, 0, player.x + 20, player.y + 30, 25);
            bodyGradient.addColorStop(0, '#D2B48C');
            bodyGradient.addColorStop(1, '#A0522D');
            ctx.fillStyle = bodyGradient;
            ctx.beginPath();
            ctx.ellipse(player.x + 20, player.y + 35, 15, 20, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // ê³ ì–‘ì´ ë¨¸ë¦¬ (ì›í˜•)
            const headGradient = ctx.createRadialGradient(player.x + 20, player.y + 10, 0, player.x + 20, player.y + 10, 18);
            headGradient.addColorStop(0, '#D2B48C');
            headGradient.addColorStop(1, '#A0522D');
            ctx.fillStyle = headGradient;
            ctx.beginPath();
            ctx.arc(player.x + 20, player.y + 10, 18, 0, Math.PI * 2);
            ctx.fill();
            
            // ê³ ì–‘ì´ ê·€
            ctx.fillStyle = '#A0522D';
            ctx.beginPath();
            ctx.ellipse(player.x + 15, player.y - 5, 4, 8, 0, 0, Math.PI * 2);
            ctx.ellipse(player.x + 25, player.y - 5, 4, 8, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // ê³ ì–‘ì´ ëˆˆ (ì›ƒëŠ” ëˆˆ)
            ctx.fillStyle = 'black';
            ctx.fillRect(player.x + 15, player.y + 5, 2, 2);
            ctx.fillRect(player.x + 25, player.y + 5, 2, 2);
            
            // ê³ ì–‘ì´ ì½”
            ctx.fillStyle = '#FFB6C1';
            ctx.beginPath();
            ctx.arc(player.x + 20, player.y + 12, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // ê³ ì–‘ì´ ì… (ì›ƒëŠ” ì…)
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(player.x + 20, player.y + 15, 3, 0, Math.PI);
            ctx.stroke();
            
            // ê³ ì–‘ì´ ë³¼ (ë¶„í™ìƒ‰)
            ctx.fillStyle = '#FFB6C1';
            ctx.beginPath();
            ctx.arc(player.x + 12, player.y + 8, 3, 0, Math.PI * 2);
            ctx.arc(player.x + 28, player.y + 8, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // ê³ ì–‘ì´ ë‹¤ë¦¬
            ctx.fillStyle = '#A0522D';
            ctx.beginPath();
            ctx.arc(player.x + 12, player.y + 55, 6, 0, Math.PI * 2);
            ctx.arc(player.x + 28, player.y + 55, 6, 0, Math.PI * 2);
            ctx.fill();
            
            // ê³ ì–‘ì´ ê¼¬ë¦¬
            ctx.fillStyle = '#A0522D';
            ctx.beginPath();
            ctx.ellipse(player.x + 35, player.y + 30, 8, 4, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // ê³ ì–‘ì´ ë°œë°”ë‹¥ (í•˜íŠ¸ ëª¨ì–‘)
            ctx.fillStyle = '#FFB6C1';
            ctx.beginPath();
            ctx.arc(player.x + 15, player.y + 58, 3, 0, Math.PI * 2);
            ctx.arc(player.x + 25, player.y + 58, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // ê³ ì–‘ì´ ìœ¤ê³½ì„ 
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(player.x + 20, player.y + 10, 18, 0, Math.PI * 2);
            ctx.ellipse(player.x + 20, player.y + 35, 15, 20, 0, 0, Math.PI * 2);
            ctx.stroke();
            
            // ë°©ì–´ë§‰ (ê³ ì–‘ì´ìš©)
            if (player.isDefending) {
                const shieldGradient = ctx.createRadialGradient(player.x + 20, player.y + 30, 0, player.x + 20, player.y + 30, 45);
                shieldGradient.addColorStop(0, 'rgba(0, 255, 255, 0.8)');
                shieldGradient.addColorStop(1, 'rgba(0, 255, 255, 0.2)');
                ctx.fillStyle = shieldGradient;
                ctx.beginPath();
                ctx.arc(player.x + 20, player.y + 30, 45, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#00FFFF';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(player.x + 20, player.y + 30, 45, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            // ì‹ ì˜ ì¶•ë³µ íš¨ê³¼ (í™©ê¸ˆìƒ‰ ë¹›)
            if (gameState.isDivineBlessing) {
                const divineGradient = ctx.createRadialGradient(player.x + 20, player.y + 30, 0, player.x + 20, player.y + 30, 50);
                divineGradient.addColorStop(0, 'rgba(255, 215, 0, 0.9)');
                divineGradient.addColorStop(0.5, 'rgba(255, 215, 0, 0.5)');
                divineGradient.addColorStop(1, 'rgba(255, 215, 0, 0.1)');
                ctx.fillStyle = divineGradient;
                ctx.beginPath();
                ctx.arc(player.x + 20, player.y + 30, 50, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.arc(player.x + 20, player.y + 30, 50, 0, Math.PI * 2);
                ctx.stroke();
            }
        }
        
        // ì  ê·¸ë¦¬ê¸°
        function drawEnemies() {
            enemies.forEach(enemy => {
                // ë¨¸ë¦¬ (ì›í˜•)
                const headGradient = ctx.createRadialGradient(enemy.x + 20, enemy.y + 10, 0, enemy.x + 20, enemy.y + 10, 15);
                headGradient.addColorStop(0, '#FFD700');
                headGradient.addColorStop(1, '#FFA500');
                ctx.fillStyle = headGradient;
                ctx.beginPath();
                ctx.arc(enemy.x + 20, enemy.y + 10, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // í™”ë‚œ ëˆˆ
                ctx.fillStyle = 'black';
                ctx.fillRect(enemy.x + 15, enemy.y + 8, 3, 3);
                ctx.fillRect(enemy.x + 25, enemy.y + 8, 3, 3);
                
                // í™”ë‚œ ì…
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(enemy.x + 15, enemy.y + 15);
                ctx.lineTo(enemy.x + 25, enemy.y + 15);
                ctx.stroke();
                
                // ëª¸ì²´ (íƒ€ì›í˜•)
                const bodyGradient = ctx.createLinearGradient(enemy.x + 10, enemy.y + 25, enemy.x + 30, enemy.y + 55);
                bodyGradient.addColorStop(0, '#FF0000');
                bodyGradient.addColorStop(1, '#8B0000');
                ctx.fillStyle = bodyGradient;
                ctx.beginPath();
                ctx.ellipse(enemy.x + 20, enemy.y + 40, 12, 20, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // íŒ” (ì›í˜•)
                ctx.fillStyle = '#8B0000';
                ctx.beginPath();
                ctx.arc(enemy.x + 8, enemy.y + 35, 6, 0, Math.PI * 2);
                ctx.arc(enemy.x + 32, enemy.y + 35, 6, 0, Math.PI * 2);
                ctx.fill();
                
                // ë‹¤ë¦¬ (ì›í˜•)
                ctx.fillStyle = '#8B0000';
                ctx.beginPath();
                ctx.arc(enemy.x + 12, enemy.y + 60, 8, 0, Math.PI * 2);
                ctx.arc(enemy.x + 28, enemy.y + 60, 8, 0, Math.PI * 2);
                ctx.fill();
            });
        }
        
        // ë³´ìŠ¤ ê·¸ë¦¬ê¸°
        function drawBosses() {
            bosses.forEach(boss => {
                // ë³´ìŠ¤ ëª¸ì²´ (ê±°ëŒ€í•œ ì )
                const bossGradient = ctx.createRadialGradient(boss.x + 40, boss.y + 50, 0, boss.x + 40, boss.y + 50, 50);
                bossGradient.addColorStop(0, '#8B0000');
                bossGradient.addColorStop(1, '#4B0082');
                ctx.fillStyle = bossGradient;
                ctx.beginPath();
                ctx.ellipse(boss.x + 40, boss.y + 50, 35, 45, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // ë³´ìŠ¤ ë¨¸ë¦¬ (ê±°ëŒ€í•œ ì›í˜•)
                const headGradient = ctx.createRadialGradient(boss.x + 40, boss.y + 20, 0, boss.x + 40, boss.y + 20, 25);
                headGradient.addColorStop(0, '#FF0000');
                headGradient.addColorStop(1, '#8B0000');
                ctx.fillStyle = headGradient;
                ctx.beginPath();
                ctx.arc(boss.x + 40, boss.y + 20, 25, 0, Math.PI * 2);
                ctx.fill();
                
                // ë³´ìŠ¤ ëˆˆ (ì•…ë§ˆ ê°™ì€ ë¹¨ê°„ ëˆˆ)
                ctx.fillStyle = '#FF0000';
                ctx.beginPath();
                ctx.arc(boss.x + 30, boss.y + 15, 5, 0, Math.PI * 2);
                ctx.arc(boss.x + 50, boss.y + 15, 5, 0, Math.PI * 2);
                ctx.fill();
                
                // ë³´ìŠ¤ ë™ê³µ (ê²€ì€ìƒ‰)
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(boss.x + 30, boss.y + 15, 2, 0, Math.PI * 2);
                ctx.arc(boss.x + 50, boss.y + 15, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // ë³´ìŠ¤ ì… (ì•…ë§ˆ ê°™ì€ ì…)
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(boss.x + 25, boss.y + 30);
                ctx.lineTo(boss.x + 55, boss.y + 30);
                ctx.stroke();
                
                // ë³´ìŠ¤ ë¿”
                ctx.fillStyle = '#8B0000';
                ctx.beginPath();
                ctx.moveTo(boss.x + 35, boss.y - 5);
                ctx.lineTo(boss.x + 40, boss.y - 15);
                ctx.lineTo(boss.x + 45, boss.y - 5);
                ctx.closePath();
                ctx.fill();
                
                ctx.beginPath();
                ctx.moveTo(boss.x + 45, boss.y - 5);
                ctx.lineTo(boss.x + 50, boss.y - 15);
                ctx.lineTo(boss.x + 55, boss.y - 5);
                ctx.closePath();
                ctx.fill();
                
                // ë³´ìŠ¤ íŒ” (ê±°ëŒ€í•œ íŒ”)
                ctx.fillStyle = '#8B0000';
                ctx.beginPath();
                ctx.arc(boss.x + 15, boss.y + 40, 15, 0, Math.PI * 2);
                ctx.arc(boss.x + 65, boss.y + 40, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // ë³´ìŠ¤ ë‹¤ë¦¬ (ê±°ëŒ€í•œ ë‹¤ë¦¬)
                ctx.fillStyle = '#8B0000';
                ctx.beginPath();
                ctx.arc(boss.x + 25, boss.y + 90, 20, 0, Math.PI * 2);
                ctx.arc(boss.x + 55, boss.y + 90, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // ë³´ìŠ¤ ìœ¤ê³½ì„ 
                ctx.strokeStyle = '#4B0082';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.arc(boss.x + 40, boss.y + 20, 25, 0, Math.PI * 2);
                ctx.ellipse(boss.x + 40, boss.y + 50, 35, 45, 0, 0, Math.PI * 2);
                ctx.stroke();
                
                // ë³´ìŠ¤ ì²´ë ¥ë°”
                const healthPercent = boss.health / boss.maxHealth;
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(boss.x, boss.y - 20, 80, 10);
                ctx.fillStyle = '#00FF00';
                ctx.fillRect(boss.x, boss.y - 20, 80 * healthPercent, 10);
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;
                ctx.strokeRect(boss.x, boss.y - 20, 80, 10);
                
                // ë³´ìŠ¤ ì²´ë ¥ í…ìŠ¤íŠ¸
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 16px Arial';
                ctx.fillText(`${boss.health}/${boss.maxHealth}`, boss.x + 20, boss.y - 25);
            });
        }
        
        // ê¹Œë§ˆê·€ ê·¸ë¦¬ê¸° (ìŠ¤íƒ€ì¼ë¦¬ì¦ˆë“œ ê¹Œë§ˆê·€)
        function drawCrows() {
            crows.forEach(crow => {
                // ê¹Œë§ˆê·€ ëª¸ì²´ (ì§„í•œ ë³´ë¼ìƒ‰)
                const bodyGradient = ctx.createRadialGradient(crow.x + 15, crow.y + 15, 0, crow.x + 15, crow.y + 15, 20);
                bodyGradient.addColorStop(0, '#4B0082');
                bodyGradient.addColorStop(1, '#2E0854');
                ctx.fillStyle = bodyGradient;
                ctx.beginPath();
                ctx.ellipse(crow.x + 15, crow.y + 15, 12, 18, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // ê¹Œë§ˆê·€ ë¨¸ë¦¬ (ì§„í•œ ë³´ë¼ìƒ‰)
                const headGradient = ctx.createRadialGradient(crow.x + 15, crow.y + 5, 0, crow.x + 15, crow.y + 5, 10);
                headGradient.addColorStop(0, '#4B0082');
                headGradient.addColorStop(1, '#2E0854');
                ctx.fillStyle = headGradient;
                ctx.beginPath();
                ctx.arc(crow.x + 15, crow.y + 5, 10, 0, Math.PI * 2);
                ctx.fill();
                
                // ê¹Œë§ˆê·€ ëˆˆ (ë…¸ë€ìƒ‰/ì—°í•œ ì´ˆë¡ìƒ‰)
                ctx.fillStyle = '#FFFF00';
                ctx.beginPath();
                ctx.arc(crow.x + 12, crow.y + 3, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // ê¹Œë§ˆê·€ ë™ê³µ (ê²€ì€ìƒ‰)
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(crow.x + 12, crow.y + 3, 1, 0, Math.PI * 2);
                ctx.fill();
                
                // ê¹Œë§ˆê·€ ë¶€ë¦¬ (íšŒìƒ‰/ê²€ì€ìƒ‰)
                ctx.fillStyle = '#696969';
                ctx.beginPath();
                ctx.moveTo(crow.x + 15, crow.y + 8);
                ctx.lineTo(crow.x + 20, crow.y + 12);
                ctx.lineTo(crow.x + 15, crow.y + 16);
                ctx.closePath();
                ctx.fill();
                
                // ê¹Œë§ˆê·€ ë‚ ê°œ (ì ‘íŒ ë‚ ê°œ)
                ctx.fillStyle = '#2E0854';
                ctx.beginPath();
                ctx.ellipse(crow.x + 8, crow.y + 15, 8, 12, 0, 0, Math.PI * 2);
                ctx.ellipse(crow.x + 22, crow.y + 15, 8, 12, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // ê¹Œë§ˆê·€ ë‹¤ë¦¬ (ê²€ì€ìƒ‰)
                ctx.fillStyle = 'black';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(crow.x + 12, crow.y + 25);
                ctx.lineTo(crow.x + 12, crow.y + 32);
                ctx.moveTo(crow.x + 18, crow.y + 25);
                ctx.lineTo(crow.x + 18, crow.y + 32);
                ctx.stroke();
                
                // ê¹Œë§ˆê·€ ë°œí†±
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(crow.x + 10, crow.y + 32, 1, 0, Math.PI * 2);
                ctx.arc(crow.x + 14, crow.y + 32, 1, 0, Math.PI * 2);
                ctx.arc(crow.x + 16, crow.y + 32, 1, 0, Math.PI * 2);
                ctx.arc(crow.x + 20, crow.y + 32, 1, 0, Math.PI * 2);
                ctx.fill();
                
                // ê¹Œë§ˆê·€ ìœ¤ê³½ì„ 
                ctx.strokeStyle = '#1A0033';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(crow.x + 15, crow.y + 5, 10, 0, Math.PI * 2);
                ctx.ellipse(crow.x + 15, crow.y + 15, 12, 18, 0, 0, Math.PI * 2);
                ctx.stroke();
                
                // ê¹Œë§ˆê·€ ê¹ƒí„¸ í•˜ì´ë¼ì´íŠ¸ (ë³´ë¼ìƒ‰)
                ctx.fillStyle = 'rgba(147, 0, 211, 0.3)';
                ctx.beginPath();
                ctx.arc(crow.x + 8, crow.y + 8, 3, 0, Math.PI * 2);
                ctx.arc(crow.x + 22, crow.y + 8, 3, 0, Math.PI * 2);
                ctx.fill();
            });
        }
        
        // ì´ì•Œ ê·¸ë¦¬ê¸°
        function drawBullets() {
            bullets.forEach(bullet => {
                // ì´ì•Œ ê·¸ë¼ë°ì´ì…˜
                const bulletGradient = ctx.createLinearGradient(bullet.x, bullet.y, bullet.x + bullet.width, bullet.y);
                bulletGradient.addColorStop(0, '#FFFF00');
                bulletGradient.addColorStop(1, '#FFD700');
                ctx.fillStyle = bulletGradient;
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                
                // ì´ì•Œ í•˜ì´ë¼ì´íŠ¸
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(bullet.x + 1, bullet.y + 1, 2, 1);
                
                // ì´ì•Œ ê¶¤ì  íš¨ê³¼
                ctx.fillStyle = 'rgba(255, 255, 0, 0.5)';
                ctx.fillRect(bullet.x - 5, bullet.y + 1, 5, 3);
            });
        }
        
        // ìŠ¤ë‚˜ì´í¼ ì´ì•Œ ê·¸ë¦¬ê¸°
        function drawSniperBullets() {
            gameState.sniperBullets.forEach(sniperBullet => {
                // ìŠ¤ë‚˜ì´í¼ ì´ì•Œ (ë¹¨ê°„ìƒ‰, ë” í¬ê³  ê°•ë ¥í•´ ë³´ì„)
                const sniperGradient = ctx.createLinearGradient(sniperBullet.x, sniperBullet.y, sniperBullet.x + sniperBullet.width, sniperBullet.y);
                sniperGradient.addColorStop(0, '#FF0000');
                sniperGradient.addColorStop(0.5, '#FF4500');
                sniperGradient.addColorStop(1, '#DC143C');
                ctx.fillStyle = sniperGradient;
                ctx.fillRect(sniperBullet.x, sniperBullet.y, sniperBullet.width, sniperBullet.height);
                
                // ìŠ¤ë‚˜ì´í¼ ì´ì•Œ í•˜ì´ë¼ì´íŠ¸
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(sniperBullet.x + 1, sniperBullet.y + 1, 2, 2);
                
                // ìŠ¤ë‚˜ì´í¼ ì´ì•Œ ê¶¤ì  íš¨ê³¼ (ë” ê°•ë ¥í•œ ë¹¨ê°„ìƒ‰)
                ctx.fillStyle = 'rgba(255, 0, 0, 0.8)';
                ctx.fillRect(sniperBullet.x - 8, sniperBullet.y + 1, 8, 4);
                
                // ìŠ¤ë‚˜ì´í¼ ì´ì•Œ íŒŒí‹°í´ íš¨ê³¼
                for (let i = 0; i < 3; i++) {
                    const particleX = sniperBullet.x - Math.random() * 10;
                    const particleY = sniperBullet.y + Math.random() * 4;
                    ctx.fillStyle = `rgba(255, 0, 0, ${Math.random() * 0.8})`;
                    ctx.beginPath();
                    ctx.arc(particleX, particleY, Math.random() * 3, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
        }
        
        // í™”ì—¼ë°©ì‚¬ê¸° ì´ì•Œ ê·¸ë¦¬ê¸°
        function drawFlamethrowerBullets() {
            gameState.flamethrowerBullets.forEach(flamethrowerBullet => {
                // í™”ì—¼ë°©ì‚¬ê¸° ì´ì•Œ (ì£¼í™©ìƒ‰-ë¹¨ê°„ìƒ‰ ê·¸ë¼ë°ì´ì…˜)
                const flameGradient = ctx.createLinearGradient(flamethrowerBullet.x, flamethrowerBullet.y, flamethrowerBullet.x + flamethrowerBullet.width, flamethrowerBullet.y);
                flameGradient.addColorStop(0, '#FF4500');
                flameGradient.addColorStop(0.3, '#FF6347');
                flameGradient.addColorStop(0.7, '#FF8C00');
                flameGradient.addColorStop(1, '#FF0000');
                ctx.fillStyle = flameGradient;
                ctx.fillRect(flamethrowerBullet.x, flamethrowerBullet.y, flamethrowerBullet.width, flamethrowerBullet.height);
                
                // í™”ì—¼ë°©ì‚¬ê¸° ì´ì•Œ í•˜ì´ë¼ì´íŠ¸ (ë…¸ë€ìƒ‰ ì¤‘ì‹¬)
                ctx.fillStyle = '#FFFF00';
                ctx.fillRect(flamethrowerBullet.x + 2, flamethrowerBullet.y + 2, 4, 4);
                
                // í™”ì—¼ë°©ì‚¬ê¸° ì´ì•Œ ê¶¤ì  íš¨ê³¼ (ì£¼í™©ìƒ‰)
                ctx.fillStyle = 'rgba(255, 69, 0, 0.9)';
                ctx.fillRect(flamethrowerBullet.x - 10, flamethrowerBullet.y + 1, 10, 6);
                
                // í™”ì—¼ë°©ì‚¬ê¸° ì´ì•Œ íŒŒí‹°í´ íš¨ê³¼ (ë” ë§ì€ íŒŒí‹°í´)
                for (let i = 0; i < 5; i++) {
                    const particleX = flamethrowerBullet.x - Math.random() * 15;
                    const particleY = flamethrowerBullet.y + Math.random() * 6;
                    const particleSize = Math.random() * 4 + 2;
                    ctx.fillStyle = `rgba(255, ${Math.floor(Math.random() * 100 + 69)}, 0, ${Math.random() * 0.9})`;
                    ctx.beginPath();
                    ctx.arc(particleX, particleY, particleSize, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // í™”ì—¼ë°©ì‚¬ê¸° ì´ì•Œ ì—°ê¸° íš¨ê³¼
                for (let i = 0; i < 3; i++) {
                    const smokeX = flamethrowerBullet.x - Math.random() * 8;
                    const smokeY = flamethrowerBullet.y + Math.random() * 4;
                    ctx.fillStyle = `rgba(128, 128, 128, ${Math.random() * 0.6})`;
                    ctx.beginPath();
                    ctx.arc(smokeX, smokeY, Math.random() * 3 + 1, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
        }
        
        // UI ê·¸ë¦¬ê¸°
        function drawUI() {
            // UI ë°°ê²½
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(10, 10, 300, 120);
            
            // ì ìˆ˜
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 20px Arial';
            ctx.fillText(`ì ìˆ˜: ${gameState.score}`, 20, 35);
            
            // ì½”ì¸
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 20px Arial';
            ctx.fillText(`ì½”ì¸: ${gameState.coins}`, 20, 60);
            
            // ì¹­í˜¸
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 20px Arial';
            ctx.fillText(`ì¹­í˜¸: ${gameState.title}`, 20, 85);
            
            // ì²´ë ¥ë°”
            ctx.fillStyle = '#FF0000';
            ctx.fillRect(20, 100, 200, 20);
            ctx.fillStyle = '#00FF00';
            ctx.fillRect(20, 100, (player.health / player.maxHealth) * 200, 20);
            
            // ì²´ë ¥ í…ìŠ¤íŠ¸
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 16px Arial';
            ctx.fillText(`ì²´ë ¥: ${player.health}/${player.maxHealth}`, 230, 115);
            
            // ê²Œì„ ì‹œê°„ í‘œì‹œ
            const remainingTime = Math.max(0, gameState.gameDuration - gameState.gameTime);
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 20px Arial';
            ctx.fillText(`ì‹œê°„: ${remainingTime.toFixed(1)}ì´ˆ`, 20, 140);
        }
        
        // ìƒì  ì˜¤ë²„ë ˆì´
        function drawShopOverlay() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 30px Arial';
            ctx.fillText('ğŸª ìƒì ', 350, 200);
            
            ctx.fillStyle = '#FFFFFF';
            ctx.font = '20px Arial';
            ctx.fillText('í˜„ì¬ ì½”ì¸: ' + gameState.coins, 300, 250);
            ctx.fillText('Q: ìƒì  ë‹«ê¸°', 300, 300);
        }
        
        // ë½‘ê¸° ì˜¤ë²„ë ˆì´
        function drawGachaOverlay() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ì¼ë°˜ ë½‘ê¸° ì‹œìŠ¤í…œ (ë²ˆê°œ ëª¨í˜• ì œê±°)
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 30px Arial';
            ctx.fillText('ğŸ° ë½‘ê¸° ì‹œìŠ¤í…œ', 320, 180);
            
            ctx.fillStyle = '#FFFFFF';
            ctx.font = '18px Arial';
            ctx.fillText('1: ì¼ë°˜ ë½‘ê¸° (100ì½”ì¸)', 200, 220);
            ctx.fillText('2: ê³ ê¸‰ ë½‘ê¸° (300ì½”ì¸)', 200, 250);
            ctx.fillText('3: ì „ì„¤ ë½‘ê¸° (1000ì½”ì¸)', 200, 280);
            ctx.fillText('R: ë½‘ê¸° ë‹«ê¸°', 200, 310);
            ctx.fillText('í˜„ì¬ ì½”ì¸: ' + gameState.coins, 200, 340);
            
            if (gameState.gachaResult) {
                ctx.fillStyle = '#FF69B4';
                ctx.font = 'bold 24px Arial';
                ctx.fillText(`ğŸ‰ ë½‘ê¸° ê²°ê³¼: ${gameState.gachaResult}`, 200, 380);
            }
        }
        
        // ë²ˆê°œ íš¨ê³¼ ê·¸ë¦¬ê¸°
        function drawLightningEffects() {
            const time = Date.now() * 0.001;
            
            // ë²ˆê°œ ì°½ ë°°ê²½
            ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
            ctx.fillRect(150, 100, 500, 400);
            
            // ë²ˆê°œ ì°½ í…Œë‘ë¦¬
            ctx.strokeStyle = '#FFFF00';
            ctx.lineWidth = 5;
            ctx.strokeRect(150, 100, 500, 400);
            
            // ë²ˆê°œ ì°½ ë‚´ë¶€ ê·¸ë¼ë°ì´ì…˜
            const windowGradient = ctx.createLinearGradient(150, 100, 650, 500);
            windowGradient.addColorStop(0, 'rgba(255, 255, 0, 0.1)');
            windowGradient.addColorStop(0.5, 'rgba(255, 255, 0, 0.05)');
            windowGradient.addColorStop(1, 'rgba(255, 255, 0, 0.1)');
            ctx.fillStyle = windowGradient;
            ctx.fillRect(155, 105, 490, 390);
            
            // ë²ˆê°œ 1 (ì°½ ì•ˆìª½)
            ctx.strokeStyle = '#FFFF00';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(200, 150);
            ctx.lineTo(250, 200);
            ctx.lineTo(220, 250);
            ctx.lineTo(280, 300);
            ctx.stroke();
            
            // ë²ˆê°œ 2 (ì°½ ì•ˆìª½)
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(500, 170);
            ctx.lineTo(450, 220);
            ctx.lineTo(480, 270);
            ctx.lineTo(420, 320);
            ctx.stroke();
            
            // ë²ˆê°œ 3 (ì›€ì§ì´ëŠ” íš¨ê³¼) - ì†ë„ ì¦ê°€
            ctx.strokeStyle = `rgba(255, 255, 0, ${0.7 + 0.3 * Math.sin(time * 15)})`; // 8ì—ì„œ 15ë¡œ ì¦ê°€
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(350, 130);
            ctx.lineTo(370, 180);
            ctx.lineTo(330, 230);
            ctx.lineTo(390, 280);
            ctx.stroke();
            
            // ë²ˆê°œ 4 (ì¶”ê°€) - ì†ë„ ì¦ê°€
            ctx.strokeStyle = `rgba(255, 255, 0, ${0.6 + 0.4 * Math.sin(time * 12)})`; // 6ì—ì„œ 12ë¡œ ì¦ê°€
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(550, 200);
            ctx.lineTo(520, 250);
            ctx.lineTo(540, 300);
            ctx.lineTo(500, 350);
            ctx.stroke();
            
            // ë²ˆê°œ íŒŒí‹°í´ íš¨ê³¼ (ì°½ ì•ˆìª½) - í™•ë¥  ì¦ê°€
            for (let i = 0; i < 30; i++) { // 15ê°œì—ì„œ 30ê°œë¡œ ì¦ê°€
                const x = 170 + Math.random() * 460;
                const y = 120 + Math.random() * 360;
                const size = Math.random() * 5 + 3; // í¬ê¸°ë„ ì¦ê°€
                
                ctx.fillStyle = `rgba(255, 255, 0, ${Math.random() * 0.9})`; // íˆ¬ëª…ë„ ì¦ê°€
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // ì¶”ê°€ ë²ˆê°œ íš¨ê³¼ë“¤
            // ë²ˆê°œ 5 (ìƒˆë¡œìš´ ë²ˆê°œ)
            ctx.strokeStyle = `rgba(255, 255, 0, ${0.8 + 0.2 * Math.sin(time * 10)})`;
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(300, 140);
            ctx.lineTo(320, 190);
            ctx.lineTo(280, 240);
            ctx.lineTo(340, 290);
            ctx.stroke();
            
            // ë²ˆê°œ 6 (ìƒˆë¡œìš´ ë²ˆê°œ)
            ctx.strokeStyle = `rgba(255, 255, 0, ${0.7 + 0.3 * Math.sin(time * 7)})`;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(450, 160);
            ctx.lineTo(430, 210);
            ctx.lineTo(460, 260);
            ctx.lineTo(420, 310);
            ctx.stroke();
            
            // ë²ˆê°œ 7 (ìƒˆë¡œìš´ ë²ˆê°œ)
            ctx.strokeStyle = `rgba(255, 255, 0, ${0.6 + 0.4 * Math.sin(time * 9)})`;
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(380, 120);
            ctx.lineTo(400, 170);
            ctx.lineTo(360, 220);
            ctx.lineTo(420, 270);
            ctx.stroke();
            
            // ë²ˆê°œ ì°½ ì½”ë„ˆ ì¥ì‹
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 3;
            // ì™¼ìª½ ìœ„ ì½”ë„ˆ
            ctx.beginPath();
            ctx.moveTo(150, 120);
            ctx.lineTo(170, 120);
            ctx.moveTo(150, 120);
            ctx.lineTo(150, 140);
            ctx.stroke();
            
            // ì˜¤ë¥¸ìª½ ìœ„ ì½”ë„ˆ
            ctx.beginPath();
            ctx.moveTo(650, 120);
            ctx.lineTo(630, 120);
            ctx.moveTo(650, 120);
            ctx.lineTo(650, 140);
            ctx.stroke();
            
            // ì™¼ìª½ ì•„ë˜ ì½”ë„ˆ
            ctx.beginPath();
            ctx.moveTo(150, 480);
            ctx.lineTo(170, 480);
            ctx.moveTo(150, 480);
            ctx.lineTo(150, 460);
            ctx.stroke();
            
            // ì˜¤ë¥¸ìª½ ì•„ë˜ ì½”ë„ˆ
            ctx.beginPath();
            ctx.moveTo(650, 480);
            ctx.lineTo(630, 480);
            ctx.moveTo(650, 480);
            ctx.lineTo(650, 460);
            ctx.stroke();
        }
        
        // ê²Œì„ì˜¤ë²„ ì˜¤ë²„ë ˆì´
        function drawGameOverOverlay() {
            // ê²Œì„ì˜¤ë²„ ë°°ê²½
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ê²Œì„ ê²°ê³¼ í…ìŠ¤íŠ¸
            if (gameState.gameTime >= gameState.gameDuration) {
                // ìŠ¹ë¦¬
                ctx.fillStyle = '#00FF00';
                ctx.font = 'bold 60px Arial';
                ctx.fillText('ğŸ‰ VICTORY! ğŸ‰', 200, 200);
                ctx.fillStyle = '#FFD700';
                ctx.font = 'bold 30px Arial';
                ctx.fillText('30ì´ˆ ìƒì¡´ ì„±ê³µ!', 300, 240);
            } else {
                // íŒ¨ë°°
                ctx.fillStyle = '#FF0000';
                ctx.font = 'bold 60px Arial';
                ctx.fillText('ğŸ’€ GAME OVER ğŸ’€', 200, 200);
            }
            
            // ìµœì¢… ì ìˆ˜
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 30px Arial';
            ctx.fillText(`ìµœì¢… ì ìˆ˜: ${gameState.score}`, 300, 280);
            ctx.fillText(`íšë“ ì½”ì¸: ${gameState.coins}`, 300, 320);
            ctx.fillText(`ì²˜ì¹˜í•œ ì : ${gameState.enemiesKilled}ë§ˆë¦¬`, 300, 360);
            ctx.fillText(`ì²˜ì¹˜í•œ ê¹Œë§ˆê·€: ${gameState.crowsKilled}ë§ˆë¦¬`, 300, 400);
            
            // ë‹¤ì‹œ í”Œë ˆì´í•˜ê¸° ë²„íŠ¼
            ctx.fillStyle = '#00FF00';
            ctx.fillRect(300, 450, 200, 60);
            ctx.strokeStyle = '#FFFFFF';
            ctx.lineWidth = 3;
            ctx.strokeRect(300, 450, 200, 60);
            
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 24px Arial';
            ctx.fillText('ğŸ”„ ë‹¤ì‹œ í”Œë ˆì´í•˜ê¸°', 320, 490);
            
            // ê²Œì„ì˜¤ë²„ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
            gameState.gameOverTimer += 1/60;
        }
        
        // ë½‘ê¸° ì‹¤í–‰
        function performGacha(type) {
            let cost = 0;
            let rewards = [];
            
            if (type === 1) {
                cost = 100;
                rewards = ['í™”ì—¼ ì´ì•Œ 30ë°œ', 'ë¬´ì  ë°©ì–´ë§‰ (10ì´ˆê°„)', 'ì½”ì¸ 50ê°œ', 'ì²´ë ¥ íšŒë³µ', 'ğŸ™ ì‹ ì˜ ì¶•ë³µ (ì¼ë°˜)', 'ğŸ¯ ìŠ¤ë‚˜ì´í¼ ì €ê²©', 'ğŸ”¥ í™”ì—¼ë°©ì‚¬ê¸°'];
            } else if (type === 2) {
                cost = 300;
                rewards = ['íŠ¹ë³„ ì¹­í˜¸ í•´ê¸ˆ', 'ì½”ì¸ 2ë°°', 'ë¬´ì  ì‹œê°„ (30ì´ˆ)', 'ê°•í™” ì´ì•Œ', 'ğŸ™ ì‹ ì˜ ì¶•ë³µ (ê³ ê¸‰)', 'ğŸŒŸ ì‹ ì˜ ì€ì´', 'ğŸ¯ ìŠ¤ë‚˜ì´í¼ ì €ê²©', 'ğŸ”¥ í™”ì—¼ë°©ì‚¬ê¸°'];
            } else if (type === 3) {
                cost = 1000;
                rewards = ['ì „ì„¤ ë¬´ê¸°', 'ë¬´í•œ ì´ì•Œ', 'ì‹ í™”ê¸‰ ì¹­í˜¸', 'ì½”ì¸ 10ë°°', 'ğŸ™ ì‹ ì˜ ì¶•ë³µ (ì „ì„¤)', 'ğŸŒŸ ì‹ ì˜ ì€ì´ (ìµœê³ ê¸‰)', 'âœ¨ ì‹ ì˜ ê¶ŒëŠ¥', 'ğŸ¯ ìŠ¤ë‚˜ì´í¼ ì €ê²©', 'ğŸ”¥ í™”ì—¼ë°©ì‚¬ê¸°'];
            }
            
            if (gameState.coins >= cost) {
                gameState.coins -= cost;
                
                // 50% í™•ë¥ ë¡œ ì‹ ì˜ ì¶•ë³µ ë˜ëŠ” ë²ˆê°œ íš¨ê³¼
                const divineChance = Math.random();
                let result;
                
                if (divineChance < 0.5) { // 50% í™•ë¥ 
                    if (type === 1) {
                        result = 'ğŸ™ ì‹ ì˜ ì¶•ë³µ (ì¼ë°˜)';
                    } else if (type === 2) {
                        result = Math.random() < 0.5 ? 'ğŸ™ ì‹ ì˜ ì¶•ë³µ (ê³ ê¸‰)' : 'ğŸŒŸ ì‹ ì˜ ì€ì´';
                    } else if (type === 3) {
                        const divineOptions = ['ğŸ™ ì‹ ì˜ ì¶•ë³µ (ì „ì„¤)', 'ğŸŒŸ ì‹ ì˜ ì€ì´ (ìµœê³ ê¸‰)', 'âœ¨ ì‹ ì˜ ê¶ŒëŠ¥'];
                        result = divineOptions[Math.floor(Math.random() * divineOptions.length)];
                    }
                } else { // 50% í™•ë¥ ë¡œ ì¼ë°˜ ë³´ìƒ
                    result = rewards[Math.floor(Math.random() * rewards.length)];
                }
                
                gameState.gachaResult = result;
                console.log('ë½‘ê¸° ì„±ê³µ! ê²°ê³¼:', result, 'ì‹ ì˜ ì¶•ë³µ í™•ë¥ :', divineChance < 0.5 ? 'ì„±ê³µ!' : 'ì‹¤íŒ¨');
                
                // ì‹ ì˜ ì¶•ë³µ íš¨ê³¼ ì ìš©
                if (result.includes('ì‹ ì˜ ì¶•ë³µ') || result.includes('ì‹ ì˜ ì€ì´') || result.includes('ì‹ ì˜ ê¶ŒëŠ¥')) {
                    // ì²´ë ¥ ì™„ì „ íšŒë³µ
                    player.health = player.maxHealth;
                    
                    // 5ì´ˆê°„ ë¬´ì  ìƒíƒœ
                    gameState.isDivineBlessing = true;
                    gameState.divineBlessingTimer = 0;
                    
                    console.log('ğŸ™ ì‹ ì˜ ì¶•ë³µ ë°œë™! ì²´ë ¥ ì™„ì „ íšŒë³µ, 5ì´ˆê°„ ë¬´ì !');
                }
                
                // ìŠ¤ë‚˜ì´í¼ ì €ê²© íš¨ê³¼ ì ìš©
                if (result.includes('ìŠ¤ë‚˜ì´í¼ ì €ê²©')) {
                    // 5ì´ˆê°„ ìŠ¤ë‚˜ì´í¼ ëª¨ë“œ í™œì„±í™”
                    gameState.isSniperActive = true;
                    gameState.sniperTimer = 0;
                    gameState.sniperBullets = [];
                    
                    console.log('ğŸ¯ ìŠ¤ë‚˜ì´í¼ ì €ê²© ëª¨ë“œ ë°œë™! 5ì´ˆê°„ ìœ„ì—ì„œ ëŒ€ê°ì„  ì €ê²©!');
                    
                    // ìŠ¤ë‚˜ì´í¼ ì´ì•Œ ìë™ ë°œì‚¬ ì‹œì‘
                    startSniperMode();
                }
                
                // í™”ì—¼ë°©ì‚¬ê¸° íš¨ê³¼ ì ìš©
                if (result.includes('í™”ì—¼ë°©ì‚¬ê¸°')) {
                    // 8ì´ˆê°„ í™”ì—¼ë°©ì‚¬ê¸° ëª¨ë“œ í™œì„±í™”
                    gameState.isFlamethrowerActive = true;
                    gameState.flamethrowerTimer = 0;
                    gameState.flamethrowerBullets = [];
                    
                    console.log('ğŸ”¥ í™”ì—¼ë°©ì‚¬ê¸° ëª¨ë“œ ë°œë™! 8ì´ˆê°„ ê·¼ì²˜ ëª¨ë“  ì  ì œê±°!');
                    
                    // í™”ì—¼ë°©ì‚¬ê¸° ë²”ìœ„ ê³µê²© ì‹œì‘
                    startFlamethrowerMode();
                }
            } else {
                gameState.gachaResult = 'ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!';
                console.log('ë½‘ê¸° ì‹¤íŒ¨: ì½”ì¸ ë¶€ì¡±');
            }
        }
        
        // ìŠ¤ë‚˜ì´í¼ ëª¨ë“œ ì‹œì‘ í•¨ìˆ˜
        function startSniperMode() {
            // 0.5ì´ˆë§ˆë‹¤ ìŠ¤ë‚˜ì´í¼ ì´ì•Œ ë°œì‚¬
            const sniperInterval = setInterval(() => {
                if (!gameState.isSniperActive) {
                    clearInterval(sniperInterval);
                    return;
                }
                
                // ìœ„ì—ì„œ ëŒ€ê°ì„ ìœ¼ë¡œ ë°œì‚¬ë˜ëŠ” ìŠ¤ë‚˜ì´í¼ ì´ì•Œ
                const sniperBullet = {
                    x: Math.random() * canvas.width, // ëœë¤ X ìœ„ì¹˜
                    y: -20, // í™”ë©´ ìœ„ì—ì„œ ì‹œì‘
                    width: 8,
                    height: 8,
                    speedX: (Math.random() * 3 + 2), // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™
                    speedY: (Math.random() * 3 + 2)  // ì•„ë˜ë¡œ ì´ë™
                };
                
                gameState.sniperBullets.push(sniperBullet);
                console.log('ìŠ¤ë‚˜ì´í¼ ì´ì•Œ ë°œì‚¬! ìœ„ì¹˜:', sniperBullet.x, sniperBullet.y);
                
            }, 500); // 0.5ì´ˆë§ˆë‹¤ ë°œì‚¬
        }
        
        // í™”ì—¼ë°©ì‚¬ê¸° ëª¨ë“œ ì‹œì‘ í•¨ìˆ˜
        function startFlamethrowerMode() {
            // 1ì´ˆë§ˆë‹¤ í™”ì—¼ë°©ì‚¬ê¸° ë²”ìœ„ ê³µê²©
            const flamethrowerInterval = setInterval(() => {
                if (!gameState.isFlamethrowerActive) {
                    clearInterval(flamethrowerInterval);
                    return;
                }
                
                // í”Œë ˆì´ì–´ ì£¼ë³€ 200í”½ì…€ ë°˜ê²½ ë‚´ì˜ ëª¨ë“  ì  ì œê±°
                const playerCenterX = player.x + 20;
                const playerCenterY = player.y + 30;
                const range = 200; // í™”ì—¼ë°©ì‚¬ê¸° ë²”ìœ„
                
                // ì  ì œê±°
                for (let i = enemies.length - 1; i >= 0; i--) {
                    const enemy = enemies[i];
                    const distance = Math.sqrt(
                        Math.pow(enemy.x + 20 - playerCenterX, 2) + 
                        Math.pow(enemy.y + 30 - playerCenterY, 2)
                    );
                    
                    if (distance <= range) {
                        enemies.splice(i, 1);
                        gameState.score += 100;
                        gameState.coins += 30;
                        gameState.enemiesKilled++;
                        updateTitle();
                        console.log('í™”ì—¼ë°©ì‚¬ê¸°ë¡œ ê·¼ì²˜ ì  ì œê±°!');
                    }
                }
                
                // ê¹Œë§ˆê·€ ì œê±°
                for (let i = crows.length - 1; i >= 0; i--) {
                    const crow = crows[i];
                    const distance = Math.sqrt(
                        Math.pow(crow.x + 15 - playerCenterX, 2) + 
                        Math.pow(crow.y + 15 - playerCenterY, 2)
                    );
                    
                    if (distance <= range) {
                        crows.splice(i, 1);
                        gameState.score += 150;
                        gameState.coins += 50;
                        gameState.crowsKilled++;
                        updateTitle();
                        console.log('í™”ì—¼ë°©ì‚¬ê¸°ë¡œ ê·¼ì²˜ ê¹Œë§ˆê·€ ì œê±°!');
                    }
                }
                
                // ë³´ìŠ¤ ì œê±° (ë³´ìŠ¤ëŠ” ë” ê°•í•˜ë¯€ë¡œ ì²´ë ¥ë§Œ ê°ì†Œ)
                for (let i = bosses.length - 1; i >= 0; i--) {
                    const boss = bosses[i];
                    const distance = Math.sqrt(
                        Math.pow(boss.x + 40 - playerCenterX, 2) + 
                        Math.pow(boss.y + 50 - playerCenterY, 2)
                    );
                    
                    if (distance <= range) {
                        boss.health -= 50; // ë³´ìŠ¤ì—ê²Œ í° ë°ë¯¸ì§€
                        console.log('í™”ì—¼ë°©ì‚¬ê¸°ë¡œ ë³´ìŠ¤ ë°ë¯¸ì§€! ë³´ìŠ¤ ì²´ë ¥:', boss.health);
                        
                        if (boss.health <= 0) {
                            bosses.splice(i, 1);
                            gameState.score += 500;
                            gameState.coins += 200;
                            console.log('í™”ì—¼ë°©ì‚¬ê¸°ë¡œ ë³´ìŠ¤ ì œê±°!');
                        }
                    }
                }
                
                // í™”ì—¼ë°©ì‚¬ê¸° ì‹œê°ì  íš¨ê³¼ ìƒì„±
                createFlamethrowerEffect();
                
            }, 1000); // 1ì´ˆë§ˆë‹¤ ë²”ìœ„ ê³µê²©
        }
        
        // í™”ì—¼ë°©ì‚¬ê¸° ì‹œê°ì  íš¨ê³¼ ìƒì„±
        function createFlamethrowerEffect() {
            // í™”ì—¼ë°©ì‚¬ê¸° íŒŒí‹°í´ íš¨ê³¼ë¥¼ ìœ„í•œ ì„ì‹œ ì´ì•Œë“¤ ìƒì„±
            for (let i = 0; i < 20; i++) {
                const effectBullet = {
                    x: player.x + 30 + Math.random() * 200,
                    y: player.y + 30 + (Math.random() - 0.5) * 100,
                    width: Math.random() * 8 + 4,
                    height: Math.random() * 8 + 4,
                    speedX: Math.random() * 3 + 2,
                    speedY: (Math.random() - 0.5) * 2,
                    life: 30 // 30í”„ë ˆì„ ë™ì•ˆ ì§€ì†
                };
                gameState.flamethrowerBullets.push(effectBullet);
            }
        }
        
        // ê²Œì„ ë¦¬ì…‹ í•¨ìˆ˜
        function resetGame() {
            // ê²Œì„ ìƒíƒœ ë¦¬ì…‹
            gameState.score = 0;
            gameState.coins = 0;
            gameState.title = "ğŸŒ± ìƒˆì‹¹ ì „ì‚¬";
            gameState.gameTime = 0;
            gameState.isPaused = false;
            gameState.isShopOpen = false;
            gameState.isGachaOpen = false;
            gameState.enemiesKilled = 0;
            gameState.crowsKilled = 0;
            gameState.gachaResult = null;
            gameState.isDivineBlessing = false;
            gameState.divineBlessingTimer = 0;
            gameState.isGameOver = false;
            gameState.gameOverTimer = 0;
            gameState.bossSpawned = false;
            gameState.isSniperActive = false;
            gameState.sniperTimer = 0;
            gameState.sniperBullets = [];
            
            // í”Œë ˆì´ì–´ ë¦¬ì…‹
            player.x = 100;
            player.y = 450;
            player.velocityY = 0;
            player.isJumping = false;
            player.isDefending = false;
            player.health = 100;
            
            // ê²Œì„ ê°ì²´ë“¤ ë¦¬ì…‹
            enemies.length = 0;
            crows.length = 0;
            bullets.length = 0;
            bosses.length = 0;
            gameState.sniperBullets.length = 0;
            gameState.flamethrowerBullets.length = 0;
            
            // íƒ€ì´ë¨¸ ë¦¬ì…‹
            enemySpawnTimer = 0;
            crowSpawnTimer = 0;
            
            // ì´ˆê¸° ì  ìƒì„±
            enemies.push({
                x: canvas.width - 100,
                y: 450,
                width: 40,
                height: 60,
                speed: -0.8,
                health: 15
            });
            
            console.log('ê²Œì„ì´ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keydown', (e) => {
            if (e.key === ' ') { // ìŠ¤í˜ì´ìŠ¤ë°” - ì í”„
                if (!player.isJumping) {
                    player.velocityY = -15;
                    player.isJumping = true;
                    console.log('ì í”„!');
                }
            } else if (e.key === 'd' || e.key === 'D') { // Dí‚¤ - ë°©ì–´
                player.isDefending = true;
                console.log('ë°©ì–´ë§‰ í™œì„±í™”!');
            } else if (e.key === 'z' || e.key === 'Z') { // Zí‚¤ - ì´ì•Œ
                if (!gameState.isShopOpen && !gameState.isGachaOpen) {
                    const newBullet = {
                        x: player.x + 30,
                        y: player.y + 30,
                        width: 15,
                        height: 8,
                        speed: 10
                    };
                    bullets.push(newBullet);
                    console.log('ì´ì•Œ ë°œì‚¬! ì´ì•Œ ìˆ˜:', bullets.length, 'ìœ„ì¹˜:', newBullet.x, newBullet.y);
                } else {
                    console.log('ìƒì ì´ë‚˜ ë½‘ê¸°ê°€ ì—´ë ¤ìˆì–´ì„œ ì´ì•Œì„ ë°œì‚¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } else if (e.key === 'q' || e.key === 'Q') { // Qí‚¤ - ìƒì 
                gameState.isShopOpen = !gameState.isShopOpen;
                gameState.isGachaOpen = false;
                console.log('ìƒì :', gameState.isShopOpen ? 'ì—´ë¦¼' : 'ë‹«í˜');
            } else if (e.key === 'r' || e.key === 'R') { // Rí‚¤ - ë½‘ê¸°
                gameState.isGachaOpen = !gameState.isGachaOpen;
                gameState.isShopOpen = false;
                if (!gameState.isGachaOpen) {
                    gameState.gachaResult = null;
                }
                console.log('ë½‘ê¸°:', gameState.isGachaOpen ? 'ì—´ë¦¼' : 'ë‹«í˜');
            } else if (gameState.isGachaOpen) { // ë½‘ê¸°ê°€ ì—´ë ¤ìˆì„ ë•Œë§Œ
                if (e.key === '1') {
                    performGacha(1);
                } else if (e.key === '2') {
                    performGacha(2);
                } else if (e.key === '3') {
                    performGacha(3);
                }
            }
        });
        
        document.addEventListener('keyup', (e) => {
            if (e.key === 'd' || e.key === 'D') {
                player.isDefending = false;
                console.log('ë°©ì–´ë§‰ ë¹„í™œì„±í™”!');
            }
        });
        
        // ë§ˆìš°ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ (ë‹¤ì‹œ í”Œë ˆì´í•˜ê¸° ë²„íŠ¼)
        canvas.addEventListener('click', (e) => {
            if (gameState.isGameOver) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // ë‹¤ì‹œ í”Œë ˆì´í•˜ê¸° ë²„íŠ¼ í´ë¦­ í™•ì¸
                if (x >= 300 && x <= 500 && y >= 450 && y <= 510) {
                    resetGame();
                    console.log('ë‹¤ì‹œ í”Œë ˆì´í•˜ê¸° ë²„íŠ¼ í´ë¦­!');
                }
            }
        });
        
        // ê²Œì„ ì‹œì‘
        console.log('ğŸ® íˆì–´ë¡œ íƒ€ì›Œ ë””íœìŠ¤ ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!');
        
        // ì´ˆê¸° ì  ìƒì„± (ê²Œì„ ì‹œì‘ ì‹œ ì¦‰ì‹œ)
        enemies.push({
            x: canvas.width - 100,
            y: 450,
            width: 40,
            height: 60,
            speed: -0.8,
            health: 15
        });
        console.log('ì´ˆê¸° ì  ìƒì„±! í˜„ì¬ ì  ìˆ˜:', enemies.length);
        
        gameLoop();
    </script>
</body>
</html> 